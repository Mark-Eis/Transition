---
title: "Converting numeric values to class Date"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Converting numeric values to class "Date"}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, echo = FALSE}
library(Transition)
```

Copyright (c) 2026 Mark Eisler and Ana Rabaza

## 1. Introduction

For each observation of a subject in a longitudinal study data set, the main **Transition** package functions `add_prev_date()`, `add_prev_result()` and `add_transitions()` all need to identify the previous observation for that same subject, if any. For compatibility with these **Transition** package functions, the timings of observations in a dataset, each referred to as a `timepoint`, should be coded within the data frame as a column of R class [`"Date"`](https://stat.ethz.ch/R-manual/R-devel/library/base/html/Dates.html), representing calendar dates.

This vignette explains how timepoints represented by numeric values in data may easily be converted to class `"Date"`, using the R **base** package function [`as.Date()`](https://stat.ethz.ch/R-manual/R-devel/library/base/html/as.Date.html).

## 2. Convert numeric values representing year to class `"Date"`

We start by creating an example data frame of longitudinal data for three subjects, containing years 2018 to 2025 as numeric values and with observations having one of three possible ordinal values: --

```{r}
(df <- data.frame(
        subject = rep(1001:1003),
        timepoint = rep(2018:2025, each = 3),
        result = gl(3, 4, lab = c("good", "bad", "ugly"), ordered = TRUE)
    ))
```

We convert the numeric values for year in the `timepoint` column to class `"Date"`, using [`as.Date()`](https://stat.ethz.ch/R-manual/R-devel/library/base/html/as.Date.html) with consistent arbitrary values of January 1st for month and day: --

```{r}
(df <- transform(
        df,
        timepoint = as.Date(paste(timepoint, "01", "01", sep = "-"))
    ))
```

We can now use the `add_prev_result()` function with default values for all but the first argument `object`---a `data.frame` (or a subclass thereof)---to add a column of results from the previous observation: --


```{r}
(df <- add_prev_result(df))
```
Finally, we can format the class `"Date"` `timepoint` column to show just the year, as in the original data: --

```{r}
transform(df, timepoint = format(timepoint, "%Y"))
```

## 3. Convert numeric values representing year and month to class `"Date"`

We create another example data frame of longitudinal data for two subjects, containing year and month from July 2024 to June 2025 as numeric values, and with observations having one of two possible ordinal values: --

```{r}
(df <- data.frame(
        subject = 1001:1002,
        year = rep(2024:2025, each = 12),
        month = rep(c(7:12, 1:6), each = 2),
        result = gl(2, 3, lab = c("low", "high"), ordered = TRUE)
    ))
```

We convert the numeric values for year and month to class `"Date"`, using [`as.Date()`](https://stat.ethz.ch/R-manual/R-devel/library/base/html/as.Date.html) with a consistent arbitrary value of 1st for day of the month: --

```{r}
(df <- transform(
        df,
        timepoint = as.Date(paste(year, month, "01", sep = "-")),
        year = NULL,
        month = NULL
    ))
```

We can now use the `add_transitions()` function with default values for all but the first argument to add a column of transitions: --

```{r}
(df <- add_transitions(df))
```

Finally, we can format the class `"Date"` `timepoint` column to show just the month and year, as in the original data: --

```{r}
transform(df, timepoint = format(timepoint, "%b-%Y"))
```

## 4. Convert numeric values representing ages to class `"Date"`

We inspect the first 22 rows of the `Blackmore` data, which includes numeric values for age in years rather than dates: --

```{r}
head(Blackmore, 22)
```

We shall use the `add_prev_date()` function to add a column of previous test dates. For the `timepoint` argument, we convert the age values to class `"Date"` using [`as.Date()`](https://stat.ethz.ch/R-manual/R-devel/library/base/html/as.Date.html) and an arbitrary "origin" of 1st January 2000^[This is equivalent to assuming all subjects were born on the 1st January 2000, which is permissible so long as these dates are not used for any purpose other than that shown here.], to which we add the age in days^[This works because class `"Date"` is represented internally in days and has a method for the `+` operator that returns a date.] calculated as `365.25 * age` (in years).

```{r}
Blackmore <- transform(
        Blackmore,
        timepoint = as.Date("2000-01-01") + round(365.25 * age)
    )

head(Blackmore, 22)
```

To use the `add_prev_date()` function, we need to provide a `result` argument in one of two permissible formats---an ordered factor, or binary data with values of either 1 or 0; note that the `exercise` column is neither of these. Since we shall not be using the values of the `exercise` column for this demonstration, we simply add a dummy `result` column with values all `integer`&nbsp;0: --

```{r}
Blackmore <- transform(Blackmore, result = 0L)
```

We can now use `add_prev_date()` with default values for all but the first argument: --

```{r}
Blackmore <- add_prev_date(Blackmore)

head(Blackmore, 22)
```

Finally, to be consistent with the original data, we can calculate a `prev_age`^[Note that by default, R formats the `age` column to two decimal places because some ages in the `Blackmore` dataset are not whole numbers of years. These non-whole number ages are always the last observation for an individual. Consequently, all "previous ages" are indeed whole numbers and R formats the `prev_age` column without showing any decimal places.] column from the `prev_date` column, which itself can be removed along with the now superfluous `timepoint` and `result` columns: --

```{r}
Blackmore <- transform(
        Blackmore,
        prev_age = round(
                as.integer(prev_date - as.Date("2000-01-01")) / 365.25, 2
            ),
        timepoint = NULL, result = NULL, prev_date = NULL
    )

head(Blackmore, 22)
```
